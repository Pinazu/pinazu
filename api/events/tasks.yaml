events:
  - name: TaskExecute
    type: consumer
    description: Event message to execute a task. Sent by API or other services, consumed by task handlers.
    subject: v1.svc.task.execute
    messageFields:
      - name: AgentId
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: RecipientId
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: Messages
        type: "[]db.JsonRaw"
        import: "gitlab.kalliopedata.io/genai-apps/pinazu-core/internal/db"
        description: Array of JSON-encoded messages for the task
    customValidation: |
      if msg.AgentId == uuid.Nil {
        return fmt.Errorf("agent_id field is required")
      }
      if msg.RecipientId == uuid.Nil {
        return fmt.Errorf("recipient_id field is required")
      }
      if len(msg.Messages) < 1 {
        return fmt.Errorf("messages field is required")
      }

  - name: TaskHandoff
    type: consumer
    description: Event message to handoff a task to another agent. Sent by task handlers, consumed by other services.
    subject: v1.svc.task.handoff
    messageFields:
      - name: ToolRunId
        type: string
      - name: AgentID
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: AgentHandoffToID
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: Messages
        type: "[]db.JsonRaw"
        import: "gitlab.kalliopedata.io/genai-apps/pinazu-core/internal/db"
        description: Array of JSON-encoded messages for the task
    customValidation: |
      if msg.ToolRunId == "" {
        return fmt.Errorf("tool_run_id field is required")
      }
      if msg.AgentHandoffToID == uuid.Nil {
        return fmt.Errorf("agent_handoff_to_id field is required")
      }
      if msg.AgentID == uuid.Nil {
        return fmt.Errorf("agent_id field is required")
      }
      if len(msg.Messages) < 1 {
        return fmt.Errorf("messages field is required")
      }

  - name: TaskFinish
    type: consumer
    description: Event message to finish a task. Sent by task handlers, consumed by other services.
    subject: v1.svc.task.finish
    messageFields:
      - name: AgentId
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: RecipientId
        type: uuid.UUID
        import: "github.com/google/uuid"
      - name: Response
        type: "db.JsonRaw"
        import: "gitlab.kalliopedata.io/genai-apps/pinazu-core/internal/db"
        description: JSON-encoded response messages for the task result
      - name: Citations
        type: "[]db.JsonRaw"
        import: "gitlab.kalliopedata.io/genai-apps/pinazu-core/internal/db"
        description: Array of JSON-encoded citations for the task result
    customValidation: |
      if msg.AgentId == uuid.Nil {
        return fmt.Errorf("agent_id field is required")
      }
      if msg.RecipientId == uuid.Nil {
        return fmt.Errorf("recipient_id field is required")
      }
      if msg.Response == nil {
        return fmt.Errorf("response field is required")
      }

  - name: TaskCancel
    type: consumer
    description: Event message to cancel a task. Sent by API or other services, consumed by task handlers.
    subject: v1.svc.task.cancel
    messageFields: []
    customValidation: |
      // No validation needed for cancel event